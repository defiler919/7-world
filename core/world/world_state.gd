# ============================================================
# æ¨¡å—å®ªæ³•ï¼šcore/world/world_state.gd
# ============================================================
#
# ã€è¿™ä¸ªæ¨¡å—æ˜¯ä»€ä¹ˆï¼Ÿã€‘
# WorldState æ˜¯â€œä¸–ç•Œå½“å‰çŠ¶æ€çš„å¿«ç…§ï¼ˆSnapshotï¼‰â€ã€‚
#
# ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºï¼š
# - ä¸€å¼ â€œä¸–ç•Œä½“æ£€è¡¨â€
# - ä¸€ä¸ªâ€œåªè¯»çŠ¶æ€é›†åˆâ€
#
# å®ƒå›žç­”çš„é—®é¢˜åªæœ‰ä¸€ä¸ªï¼š
# ðŸ‘‰ â€œä¸–ç•ŒçŽ°åœ¨æ˜¯ä»€ä¹ˆæ ·ï¼Ÿâ€
#
# ------------------------------------------------------------
# ã€å®ƒè´Ÿè´£ä»€ä¹ˆï¼Ÿã€‘
# 1) ç»Ÿä¸€ä¿å­˜â€œå½“å‰ä¸–ç•ŒçŠ¶æ€â€çš„å…³é”®ä¿¡æ¯
# 2) ä½œä¸º Debug / UI / æ—¥å¿— çš„æ•°æ®æ¥æº
# 3) è®©ä¸åŒç³»ç»Ÿç”¨ã€åŒä¸€ä»½æè¿°ã€‘ç†è§£ä¸–ç•Œ
#
# ------------------------------------------------------------
# ã€å®ƒä¸è´Ÿè´£ä»€ä¹ˆï¼Ÿï¼ˆéžå¸¸é‡è¦ï¼‰ã€‘
# âŒ ä¸é©±åŠ¨ç›¸æœº
# âŒ ä¸å¤„ç†è¾“å…¥
# âŒ ä¸ä¿®æ”¹ä¸–ç•Œ
# âŒ ä¸å†™ç”Ÿæ€/å®žä½“/è§„åˆ™
#
# å¦‚æžœä½ å“ªå¤©æƒ³åœ¨è¿™é‡Œå†™ï¼š
#   â€œå¦‚æžœ layer == 3 å°±æ€Žæ ·â€¦â€¦â€
# é‚£ä¸€å®šæ˜¯å†™é”™åœ°æ–¹äº†ã€‚
#
# ------------------------------------------------------------
# ã€è®¾è®¡åŽŸåˆ™ï¼ˆç»™çŽ°åœ¨å’Œæœªæ¥çš„ä½ ï¼‰ã€‘
# - WorldState æ˜¯â€œè¢«å†™å…¥çš„â€ï¼Œä¸æ˜¯â€œä¸»åŠ¨è®¡ç®—çš„â€
# - å®ƒå¯ä»¥è¢«ä»»ä½•ç³»ç»Ÿè¯»å–
# - ä½†åªèƒ½ç”±â€œä¸–ç•Œä¸­æž¢â€ç»Ÿä¸€æ›´æ–°ï¼ˆé€šå¸¸æ˜¯ WorldRootï¼‰
#
# ============================================================

extends Resource
class_name WorldState



# ------------------------------------------------------------
# ä¸–ç•Œç»“æž„ç›¸å…³çŠ¶æ€
# ------------------------------------------------------------

# å½“å‰æ‰€åœ¨çš„å±‚ç´¢å¼•ï¼ˆä¸Šä¸‹ï¼‰
# è§£é‡Šï¼šç¬¬å‡ å±‚æ­£åœ¨è¢«å…³æ³¨/æµè§ˆ
var current_layer_index: int = 0

# âœ… æ–°å¢žï¼šå½“å‰æ¿€æ´»å±‚çš„ç¨³å®š IDï¼ˆé€»è¾‘ / å­˜æ¡£ / åˆ‡å±‚ç”¨ï¼‰
# è¯´æ˜Žï¼š
# - ä¸ä¾èµ–èŠ‚ç‚¹é¡ºåº
# - ä¸ä¾èµ– index
# - ä½œä¸ºâ€œä¸–ç•Œå½“å‰å±‚â€çš„å”¯ä¸€æƒå¨æ ‡è¯†
var current_layer_id: StringName = &""

# å½“å‰æ‰€åœ¨çš„åˆ—ç´¢å¼•ï¼ˆå·¦å³ï¼‰
# è§£é‡Šï¼šåŒä¸€å±‚é‡Œçš„å“ªä¸ªåœºæ™¯æ ¼ï¼ˆ0=å·¦ï¼Œ1=å³ï¼‰
var current_col_index: int = 0

# ä¸–ç•Œè¿è¡Œæ—¶é—´ï¼ˆç§’ï¼‰
# è§£é‡Šï¼šä¸æ˜¯çŽ°å®žæ—¶é—´ï¼Œè€Œæ˜¯â€œä¸–ç•Œç»è¿‡äº†å¤šä¹…â€
var world_time: float = 0.0
# ------------------------------------------------------------
# ç›¸æœºç›¸å…³çŠ¶æ€ï¼ˆåªè¯»å¿«ç…§ï¼‰
# ------------------------------------------------------------

# å½“å‰ç›¸æœºä¸­å¿ƒç‚¹ï¼ˆä¸–ç•Œåæ ‡ï¼‰
# è§£é‡Šï¼šè¿™æ˜¯ Camera2D çš„ global_position
# Debug/UI å¯ä»¥ç”¨å®ƒæ¥æ˜¾ç¤ºã€è®°å½•ã€åˆ†æž
var camera_center: Vector2 = Vector2.ZERO

# å½“å‰ç›¸æœºåœ¨â€œåœºæ™¯æ ¼å†…â€çš„åç§»
# è§£é‡Šï¼šç›¸æœºä¸­å¿ƒç›¸å¯¹äºŽ cell_center çš„åç§»é‡
# è¿™ä¸ªå€¼æœ‰åŠ©äºŽï¼š
# - Debug ç›¸æœºæ˜¯å¦è¢« clamp
# - åˆ¤æ–­çŽ©å®¶æ›´å¸¸æµè§ˆåœºæ™¯çš„å“ªä¸€ä¾§
var camera_local_offset: Vector2 = Vector2.ZERO

# ------------------------------------------------------------
# è§†å£ / æ˜¾ç¤ºç›¸å…³
# ------------------------------------------------------------

# å½“å‰å¯è§†åŒºåŸŸå¤§å°ï¼ˆåƒç´ ï¼‰
# è§£é‡Šï¼šæ¥è‡ª get_viewport().get_visible_rect().size
# ç”¨äºŽ Debug â€œå±å¹•å°ºå¯¸æ˜¯å¦å½±å“ä¸–ç•Œè¡Œä¸ºâ€
var viewport_size: Vector2 = Vector2.ZERO

# ------------------------------------------------------------
# è¾“å…¥ / åˆ‡æ¢çŠ¶æ€ï¼ˆè¾…åŠ©è°ƒè¯•ï¼‰
# ------------------------------------------------------------

# ç›¸æœºåˆ‡æ¢å†·å´å‰©ä½™æ—¶é—´ï¼ˆç§’ï¼‰
# è§£é‡Šï¼š>0 ä»£è¡¨åˆ‡æ¢ä»åœ¨å†·å´ä¸­
# DebugOverlay ç”¨å®ƒæ¥éªŒè¯â€œé˜²æŠ–æ˜¯å¦æ­£å¸¸â€
var switch_cooldown_left: float = 0.0

# ------------------------------------------------------------
# æ—¶é—´ç›¸å…³ï¼ˆé¢„ç•™ï¼‰
# ------------------------------------------------------------


# ------------------------------------------------------------
# å·¥å…·æ–¹æ³•ï¼ˆå¯é€‰ï¼‰
# ------------------------------------------------------------

# è¿”å›žä¸€ä¸ªé€‚åˆ Debug æ‰“å°çš„å­—å…¸
# è¯´æ˜Žï¼šåªç”¨äºŽè§‚å¯Ÿï¼Œä¸ç”¨äºŽé€»è¾‘åˆ¤æ–­
func to_debug_dict() -> Dictionary:
	return {
		"layer": current_layer_index,
		"col": current_col_index,
		"camera_center": camera_center,
		"camera_local_offset": camera_local_offset,
		"viewport_size": viewport_size,
		"cooldown_left": switch_cooldown_left,
		"world_time": world_time
	}
