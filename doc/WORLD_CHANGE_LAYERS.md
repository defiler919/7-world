# WORLD_CHANGE_LAYERS.md
> 7-world 可复用架构文档：世界变化分层白名单（World Change Layers Whitelist）
> 目的：让“昼夜/天气/污染/危机/剧情”等变化永远有清晰归类，避免系统互相污染、逻辑失控。

## 0. 一句话原则
- **Field（背景态）**：一直存在、连续变化、无“触发/结束”。
- **Modulator（慢变量）**：连续数值、有惯性/回归，描述“压力/状态”，可被事件影响，但本身不是事件。
- **Event（事件）**：有开始/持续/结束，会造成一次“非平稳扰动”，结束后系统应回归稳态。
- **Milestone（转折）**：一次性、不可逆、永久改变规则（默认不做，除非明确设计）。

> 判定口诀：**有没有“开始/结束”？有没有“持续期”？结束后要不要恢复？**

---

## 1. Field（世界背景态）白名单
### 定义
- 始终存在（Always-on）
- 连续变化（Continuous）
- 不占用事件槽
- 是规则的输入参数（Input）

### 常见示例
- `world_time` / `day_phase`（昼夜）
- `season`（季节，若有）
- `tide_phase`（潮汐）
- `base_temperature`（基础温度曲线）
- `layer_depth` / `biome`（层级/群落类型）
- `player_presence`（玩家是否在该层；属于输入而非事件）

### 规则
- Field **不能直接杀鱼/生鱼**，只能改变“倾向/环境参数”。
- Field 建议只通过 `WorldState`/`WorldClock` 输出，并被各系统读取。

---

## 2. Modulator（慢变量）白名单
### 定义
- 连续数值（0..1 或 0..N）
- 有惯性/回归（Inertia / Relaxation）
- 用于表现“压力条”“环境状态”
- 可被 Event 推高/推低，但必须可回落（非末日项目）

### 常见示例
- `env.pollution`（污染）
- `invasion.risk`（入侵风险/压力条）
- `oxygen`（溶氧）
- `nutrient`（营养盐）
- `temperature_anomaly`（温度异常）
- `predator_pressure`（捕食压力）

### 规则
- Modulator 必须具备至少一种 **回落机制**（自然衰减/回归/净化），否则会产生“吸收态（锁死）”。
- Modulator 的数值变化必须可解释（可在 DebugOverlay 中追踪来源）。

---

## 3. Event（事件）白名单
### 定义
- 有明确开始（Start）
- 有持续时间（Duration）
- 有明确结束（End）
- 在持续期内修改 Modulator 或 Intent（或施加一次性冲击）
- 结束后系统应走向恢复（Recover）

### 常见示例（危机/异常）
- `DeepInvasion`（深海入侵：浅海损失、深海收益）
- `RedTide`（赤潮）
- `Hypoxia`（缺氧）
- `Storm`（风暴）
- `Migration`（迁徙：短期改变分布/承载）
- `Disease`（疫病：短期提高死亡/降低繁殖）

### 事件的两种影响类型（推荐）
- **Intent Modifiers（意图层修正）**：乘法/加法修正 `spawn.* / death.* / budget.* / risk`（推荐为主）
- **Fact Shock（事实层冲击）**：事件开始时一次性扣减/转移（少量使用）

### 并发策略（默认建议）
- 结构上允许并发，但 **运行策略**控制：
  - 每层 `max_crisis = 1`
  - （未来可加）每层 `max_ambient = 1`（天气异常类）

---

## 4. Milestone（转折）白名单
### 定义
- 一次性、不可逆
- 永久改变参数或规则
- 明确写在设计文档中，不允许“顺手加”

### 示例
- 海域永久被污染（进入新纪元）
- 新物种体系解锁（生态规则替换）

---

## 5. 实操：如何归类一个新“变化”
把它按下列问答归类：

1) 它是不是一直存在、像“时钟/曲线”一样变化？
- 是 → Field

2) 它是不是连续数值、像“压力条”，可以被推高但应该能回落？
- 是 → Modulator

3) 它是不是有开始/结束，持续一段时间影响生态？
- 是 → Event

4) 它是不是永久改变世界、不会结束？
- 是 → Milestone

---

## 6. 禁止项（防跑偏）
- 禁止把 Field 当 Event（例如把“夜晚”当作事件实例）
- 禁止 Modulator 没有回落机制（污染只涨不降、风险锁死 1.0）
- 禁止 Event 直接改其他系统内部状态（必须通过统一接口/总线/规则层）
